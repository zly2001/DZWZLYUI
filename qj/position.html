<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		
		<style type="text/css">
			.el-row {
    margin-bottom: 20px;
    &:last-child {
      margin-bottom: 0;
    }
  }
  .el-col {
    border-radius: 4px;
  }
  .bg-purple-dark {
    background: #99a9bf;
  }
  .bg-purple {
    background: #d3dce6;
  }
  .bg-purple-light {
    background: #e5e9f2;
  }
  .grid-content {
    border-radius: 4px;
    min-height: 36px;
  }
  .row-bg {
    padding: 10px 0;
    background-color: #f9fafc;
  }
  #biao{
  	font-size: 30px;
  	color: red;
  	font-weight: bold;
  }
	</style>
	</head>
	<body>
		<div id="ban">
			<el-row>
				<el-col :span="4" :offset="2">
					<span id="biao">职位定义</span>
				</el-col>
<<<<<<< HEAD
=======
				<el-col :span="2" :offset="16">
					 <el-button type="info" plain>关闭</el-button>
				</el-col>
>>>>>>> qj
			</el-row>
			<el-row>
  				<el-col :span="4" :offset="4">
  					<div>
  						<el-input :disabled="true" placeholder="职位编码自动生成" ></el-input>
  					</div>
  				</el-col>
  				<el-col :span="4" :offset="2">
  					<div>
  						<el-input v-model="position.positionnam"  placeholder="请输入职位名称" ></el-input>
  					</div>
  				</el-col>
  				<el-col :span="8" :offset="2">
  					<div>
  						 <el-button type="primary" plain @click="addPosition">增加</el-button>
  						 <el-button type="primary" plain @click="deletePosition(positionRow.positionid)">删除</el-button>
  						 <el-button type="primary" plain @click="dialogFormVisible = true">修改</el-button>
  					</div>
  				</el-col>
			</el-row>
			<el-table ref="singleTable" :data="positionData" @row-click="getDetails" highlight-current-row @current-change="handleCurrentChange" style="width: 60%;margin-left: 250px;">
				<el-table-column property="positionid" label="职位编码" width="450">
				</el-table-column>
				<el-table-column property="positionname" label="职位名称" width="450">
				</el-table-column>
			</el-table>
			<el-dialog title="岗位修改" :visible.sync="dialogFormVisible" width="30%">
				<el-form :model="positionRow">
					<el-form-item label="岗位名称" :label-width="formLabelWidth">
						<el-input v-model="positionRow.positionname" autocomplete="off"></el-input>
					</el-form-item>
				</el-form>
				<div slot="footer" class="dialog-footer">
					<el-button @click="dialogFormVisible = false">取 消</el-button>
					<el-button type="primary" @click="updatePosition">确 定</el-button>
				</div>
			</el-dialog>
		</div>
	</body>
	
	<script>
		var ban = new Vue({
			el:"#ban",
			data:{
					formLabelWidth: '120px',
					positionData: [{
					
        			}],
        			currentRow: null,
        			position:{
        				positionnam:""
        			},
        			positionRow:{
        				positionname:'',
        				positionid:""
        			},
        			dialogFormVisible: false,
				},
			mounted() {
				this.load();
			},
			methods:{
				handleCurrentChange(val) {
       				 this.currentRow = val;
      			},
      			//查询
      			load(){
      				let _this = this;
					axios.get("http://127.0.0.1:8080/DZWWeb/qj/api/QjPositionAction").then(function(resp) {
						_this.positionData = resp.data;
					}).catch(function(e) {
						console.info(e);
					});
      			},
      			//新增
      			addPosition(){
      				if(this.position.positionnam!=''){
      					let _this = this;
      					var position={
      						"positionname":this.position.positionnam,
      					};
      					$.ajax("http://127.0.0.1:8080/DZWWeb/qj/api/QjPositionAction",{
      						type:"post",
      						dataType:"json",
      						contentType:"application/json",
      						data:JSON.stringify(position),
      						success:function(data){
      						//alert(JSON.stringify(data));
      							_this.$message({
         						message: '新增成功',
          						type: 'success'
        						});
        						_this.load();
      						}
      					});
      				}else{
      							this.$message({
         						message: '请输入岗位名称',
          						type: 'warning'
        						});
      				}
      				//this.$message('这是一条消息提示');
//    				axios.post("http://127.0.0.1:8080/DZWWeb/qj/api/QjPositionAction",this.position).then(function(resp){
//						if(resp.data.code=="200"){
//							showAlertDialog('新增成功');
//							closeWindowDialog();
//							//personListVm.goToPage(1,3);
//							//this.load();
//						}
//					}).catch(function(e){
//						console.log(e);
//					});
      			},
      			getDetails(row){
      				this.positionRow.positionname = row.positionname;
      				//alert(this.positionRow.positionname)
      				this.positionRow.positionid = row.positionid;
      			},
      			//修改
      			updatePosition(){
      				//alert(this.positionRow.positionid);
      				let _this = this;
      				if(this.positionRow.positionname!=''){
        				axios.put("http://127.0.0.1:8080/DZWWeb/qj/api/QjPositionAction/position",this.positionRow).then(function(resp){
							if(resp.data.code=="200"){
								_this.$message({
         						message: '修改成功',
          						type: 'success'
        						});
        						_this.load();
							}
						}).catch(function(e){
							console.log(e);
						});
      				}
      			},
      			deletePosition(id){
      				let _this = this;
      				//alert(this.positionRow.positionid);
      				this.$confirm('删除该岗位, 是否继续?', '提示', {
          				confirmButtonText: '确定',
          				cancelButtonText: '取消',
          				type: 'warning'
        				}).then(() => {
        					axios.delete(`http://127.0.0.1:8080/DZWWeb/qj/api/QjPositionAction/position/${id}`).then(function(resp) {
							if(resp.data.code == "200") {
								_this.$message({
            					type: 'success',
            					message: '删除成功!'
          						});
          						_this.load();
							}
							})
//      					.catch(function(e) {
//								
//							});
        				}).catch(() => {
          					this.$message({
            				type: 'info',
            				message: '已取消删除'
          				});          
        			});
      			}
			}
		})
	</script>
</html>
